@model IEnumerable<Appointments>
@{
    ViewData["Title"] = "Index";
    DateTime startDate = DateTime.Today;
    int end = 5;
}


<div class="container">
    <div class="row pt-3 ms-1">
        <h1>Available Appointments</h1>
    </div>
</div>


<table class="table table-bordered table-primary">
    <thead>
        <tr id="dateRow">
            <th></th>
        </tr>
    </thead>
    <tbody>
        @for (int i = 8; i <= 20; i++)
        {
            <tr>
                <th>
                    <div>@i</div>
                </th>
                @for (int j = 0, slotsAdded = 0; slotsAdded < 5; j++)
                {
                    DateTime currentDate = startDate.AddDays(j);
                    if (currentDate.DayOfWeek == DayOfWeek.Saturday || currentDate.DayOfWeek == DayOfWeek.Sunday)
                    {
                        continue;
                    }
                    bool isOccupied = Model.Any(obj => obj != null && obj.Time.Hour == i && obj.Time.Date == currentDate);
                    <td>
                        <b>
                            <div class="@(isOccupied ? "text-danger" : "text-success")">
                                @if (isOccupied)
                                {
                                    var appointmentId = Model.FirstOrDefault(obj => obj.Time.Hour == i && obj.Time.Date == currentDate)?.Id;
                                    <a class="text-danger" style="text-decoration:none; color:red;" href="@(Url.Action("Delete", "Appointments", new { id = appointmentId }))">Occupied</a>
                                }
                                else
                                {
                                    <div>Free</div>
                                }
                            </div>
                        </b>
                    </td>
                    slotsAdded++;
                }
            </tr>
        }
    </tbody>
</table>

<div>
    <a class="btn btn-success mb-3" asp-action="Create">Create New</a>
</div>

<script>
    // Get the reference to the table header row
    const dateRow = document.getElementById("dateRow");

    // Get the current date
    const today = new Date();

    // Variable to keep track of the number of slots added
    let slotsAdded = 0;

    // Loop to populate the next 5 days
    for (let i = 0; slotsAdded < 5; i++) {
        // Create a new date object for each day
        const date = new Date(today);
        date.setDate(today.getDate() + i);

        // Check if the current day is a weekend (Saturday or Sunday)
        if (date.getDay() === 0 || date.getDay() === 6) {
            // Skip weekends
            continue;
        }

        // Extract the day and month from the date
        const day = date.getDate();
        const month = date.toLocaleString("default", { month: "short" });

        // Create a new table cell for the date and append it to the header row
        const th = document.createElement("th");
        th.textContent = `${day} ${month}`;
        dateRow.appendChild(th);

        // Increment the number of slots added
        slotsAdded++;
    }
</script>


