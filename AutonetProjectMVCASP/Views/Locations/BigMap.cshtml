
@using Newtonsoft.Json;
@model IEnumerable<AutonetProjectMVCASP.Models.Locations>


@{
    ViewData["Title"] = "BigMap";
    bool LoggedIn = (User != null) && (User.Identity.IsAuthenticated);
    int counter = 1;
    string img = "image1";


}




    <div class="containercontact">
        
            

            <div class="bigmap bg-dark">
                <h1>Map of all locations</h1>
                <div class="bigmap_map" id="bigmap" style="height: 80vh;"></div>
            </div>
            
    
           

        
    </div>


<div class="row justify-content-center pt-3">
    <div class="text-center ms-2 me-2">
        @if (LoggedIn && (User.IsInRole("Admin") || User.IsInRole("Architect")))
        {
            <a asp-action="Create" class="btn btn-primary">Create New</a>
        }
        <a asp-action="Index" class="btn btn-secondary">Locations</a>
    </div>
</div>


@section Scripts {
    <script>
        var locations = [];

        @{
            counter = 1;
        }

        @foreach (var loc in Model)
        {
            img = "image" + counter;
            @:locations.push({
            @:id: '@img',
            @:latitude: @loc.Latitude,
            @:longitude: @loc.Longitude,
            @:place: '@loc.Place',
            @:startTime: @loc.StartTime.ToString("HH"),
            @:endTime: @loc.EndTime.ToString("HH")
            @:});
            counter++;

        }

            function initializeMaps() {


                var map = new google.maps.Map(document.getElementById('bigmap'), {
                    center: { lat: 0, lng: 0 },
                    zoom: 3
                });

                locations.forEach(function (loc) {


                    var markerIcon = {
                        url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                        scaledSize: new google.maps.Size(30, 30),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(25, 50)
                    };

                    var marker = new google.maps.Marker({
                        position: { lat: loc.latitude, lng: loc.longitude },
                        map: map,
                        icon: markerIcon,
                    });


                    var contentString = `
                    <h3 class="card__title" style="color:black">${loc.place}</h3>
                    <div class="card__text" style="color:black">
                        Mon-Fri: ${loc.startTime}:00 - ${loc.endTime}:00 <br />
                        Sat-Sun: Closed
                    </div>
                `;

                    var infowindow = new google.maps.InfoWindow({
                        content: contentString,
                    });

                    marker.addListener('click', function () {
                        window.location.href = '/Locations/Details?place=' + encodeURIComponent(loc.place);
                    });

                    marker.addListener('mouseover', function () {
                        infowindow.open(map, marker);
                    });

                    marker.addListener('mouseout', function () {
                        infowindow.close();  // Close the infowindow when mouse is moved away from the marker
                    });

                    console.log('Map initialized for:', loc.place);
                });
            }

        function initMap() {
            console.log('Google Maps API loaded');
            initializeMaps();
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBT7QWZaUcL4n36Dj8toB0Tui1Ur8vmFRg&callback=initMap" async defer></script>
}
